% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main.R
\name{cox_knockoff_analysis}
\alias{cox_knockoff_analysis}
\title{Complete Cox Knockoff Analysis Workflow}
\usage{
cox_knockoff_analysis(
  X = NULL,
  pos = NULL,
  time,
  status,
  gds_file = NULL,
  sample_ids = NULL,
  covariates = NULL,
  M = 5,
  fdr = 0.1,
  method = "difference",
  use_spa = TRUE,
  save_gds = TRUE,
  output_dir = NULL
)
}
\arguments{
\item{X}{Genotype matrix (samples x SNPs) - only needed if gds_file is NULL}

\item{pos}{SNP positions vector - only needed if gds_file is NULL}

\item{time}{Survival times}

\item{status}{Event indicators (1=event, 0=censored)}

\item{gds_file}{Path to existing GDS file with knockoffs (optional)}

\item{sample_ids}{Sample IDs (optional, will be generated if NULL)}

\item{covariates}{Optional covariate matrix/data.frame}

\item{M}{Number of knockoff copies to generate (default: 5)}

\item{fdr}{Target false discovery rate (default: 0.1)}

\item{method}{Statistical method for W statistics ("difference", "mk_median")}

\item{use_spa}{Whether to use SPA test when available (default: TRUE)}

\item{save_gds}{Whether to save knockoffs to GDS format (default: TRUE)}

\item{output_dir}{Directory to save GDS files (default: extdata folder)}
}
\value{
List containing:
  \item{selected_vars}{Indices of selected variables}
  \item{W_stats}{W statistics for all variables}
  \item{threshold}{Knockoff threshold used}
  \item{gds_file}{Path to GDS file used}
  \item{test_results}{SPA test results}
}
\description{
Performs a complete Model-X knockoff analysis following the three-step workflow:
1. Generate knockoff variables and save to GDS format
2. Perform SPA testing using GDS data
3. Apply knockoff filter for variable selection
}
\examples{
\dontrun{
# Method 1: Standard workflow with PLINK data
extdata_path <- system.file('extdata', package = 'CoxMK')
plink_data <- load_plink_data(file.path(extdata_path, 'sample'))
pheno_data <- prepare_phenotype(file.path(extdata_path, 'tte_phenotype.txt'))
covar_data <- load_covariates(file.path(extdata_path, 'covariates.txt'))

# Generate knockoffs and save to GDS format
result1 <- cox_knockoff_analysis(
  X = plink_data$genotypes,
  pos = plink_data$positions,
  time = pheno_data$time,
  status = pheno_data$status,
  covariates = covar_data,
  M = 3,
  fdr = 0.1,
  save_gds = TRUE
)

# Method 2: Reuse existing GDS file
gds_file <- result1$gds_file
result2 <- cox_knockoff_analysis(
  gds_file = gds_file,
  time = pheno_data$time,
  status = pheno_data$status,
  covariates = covar_data,
  fdr = 0.05  # Different FDR threshold
)

# Method 3: Quick test with example data (no GDS)
data(example_genotypes)
data(example_positions)
data(example_phenotype)

result3 <- cox_knockoff_analysis(
  X = example_genotypes,
  pos = example_positions,
  time = example_phenotype$time,
  status = example_phenotype$status,
  save_gds = FALSE  # Skip GDS for quick testing
)

# View selected variables
print(result3$selected_vars)
}
}
